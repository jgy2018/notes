###redis简介
Redis是基于内存的
采用Key-Value结构化存储的Nosql数据库
底层采用单线程和I/O复用模型，所以查询速度很快，QPS可以达到10万+，可以满足大部的高并发请求

可以用于缓存、事件发布和订阅，高速队列等场景
提供字符串，哈希，列表，队列，集合直接存存取，
基于内存，可以持久化

一种非关系性数据库，是介于接口服务端和数据库的中间层。用做缓存使用
用法：比如一个查询接口，第一次查询从数据库查数据，查完之后我们把数据存入redis缓存中，第二次查就可以直接从缓存中读取数据，这就是它的用法。

那么一般我们把什么数据存入redis缓存中呢？主要是一些复杂操作，耗费时间长的，比如数据库查询要600ms，但是redis只需要20ms。

而且，在接下来的几个小时内，这个数据都不会变化，我们就可以存入缓存数据库，为什么对时间有要求呢？因为缓存中的数据一般都是有过期时间的，这个开发写代码可以设置。

####redis的优势
1.读取速度快。因为缓存是写入内存中的，普通数据库数据是写在磁盘中的，基于内存的相比于磁盘速度是快很多的，但是也缺点，比如断电之后，内存中的数据会消失，磁盘则不会。
2.高并发，减轻数据库压力。一旦涉及大数据量需求，比如一些商品抢购等，或者主页瞬间访问量大的时候，磁盘读写上千上万次，有性能弊端。容易造成数据库瘫痪，服务器宕机。数据库顶不住，需要缓存分担一部分压力。

####redis的数据类型
主要有五种，字符串，哈希，列表，集合，有序集合

####redis的雪崩，缓存穿透，缓存击穿机制
1、雪崩机制
假设数据库访问量是每秒5千请求，redis数据库可以抗住每秒4千请求。但是redis数据库因为意外宕机，那么这五千个请求就会全部打到数据库上。

这个时候数据库就挂掉了，这个时候如果没有特别的方案来处理这个故障，DBA直接重启数据库，那么马上又会被新的流量打死，这个就是redis雪崩机制。
![](https://img-blog.csdnimg.cn/20210811111030276.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTcyMTc2OQ==,size_16,color_FFFFFF,t_70)

2、缓存穿透
假设一个系统每秒5千请求，但是有4千是黑客恶意攻击发起的，缓存中差不到，数据库中也查不到。

比如说，数据库id都是从1开始的，但是黑客发过来的请求id都是负数，所以缓存中查不到，就会直接打到数据库，数据库就会挂掉，这种就是缓存穿透
![](https://img-blog.csdnimg.cn/20210811111120986.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTcyMTc2OQ==,size_16,color_FFFFFF,t_70)

3、缓存击穿
这个就是说某个缓存数据库的key值，访问非常频繁，一直处于高并发访问，但是因为一些原因这个key失效，那么数据流量就把缓存击穿，瞬间打到数据库上，就像在屏风上凿开一个洞。

![](https://img-blog.csdnimg.cn/img_convert/d977f745218e40633826ba0c88ee005f.png)

加快访问速度、减少服务器和db压力

####缓存的生成方式
1、“外面”缓存
针对请求参数多变，返回的数据如果跟请求参数强相关，适合在“外面”（请求参数过滤之后）缓存查询到的数据。这类数据一般缓存时间短，比如缓存5分钟。主要应对相同请求参数在短时间内的重复请求。如果遇到请求攻击，即使这个缓存有效期只有1秒，也是很有效的，能挡住大量的请求
![](https://img-blog.csdnimg.cn/img_convert/ab725822aaea123c1ff963774b88684b.png)

2、“里面”缓存
针对请求参数变化不大，返回的数据跟db中存储的数据很接近的情况，适合在“里面”缓存数据，也就是在更新db的同时更新缓存，这种情况最优的状态下，只需要读缓存就够了，不需要跟db直接交互，能大大缓解db压力。这种缓存有效期可以设置很长
![](https://img-blog.csdnimg.cn/img_convert/6552dd9642f8c76ea1367eb6de369b91.png)

###redis缓存测试点
1、性能测试角度
缓存增加/更新功能是否正确，查看缓存数据是否正确
a. 增加相关日志，查看日志
b. 后门接口工具
c. 使用命令行，memcached和reids可以登录后，直接查看

缓存删除
2.1 缓存有效，验证相关业务功能
2.2 缓存被删除，验证相关业务功能
2.3 缓存过期失效，memcached 和redis 可以设置失效时间，查看失效时间有没有，对不对

超量淘汰机制：缓存达到上限怎么处理
缓存穿透
缓存雪崩
redis缓存服务停掉
缓存超时
缓存数据被误修改后，快速恢复到指定版本
缓存数据被误删除后，快速恢复数据

2、redis功能测试角度
redis数据生效时，读取是否正确
redis数据不存在，能否正常从db中读取到正确的值，并正确写入Redis和返回给上层
数据在redis和db中都不存在时的表现是否正常
删除数据时，redis和db的数据是否一致